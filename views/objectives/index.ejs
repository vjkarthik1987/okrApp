<% layout('layouts/dashboard') %>
<% title = 'Objectives' %>

<h2 class="mb-4">ğŸ“‹ Objectives</h2>

<a href="/<%= orgName %>/objectives/new" class="btn btn-primary mb-3">â• Add New Objective</a>

<form method="GET" class="mb-3 d-flex align-items-center gap-2">
  <label for="quarter" class="form-label mb-0">Filter by Cycle:</label>
  <select name="cycle" id="quarter" class="form-select" onchange="this.form.submit()">
    <option value="">All</option>
    <% enabledCycles.forEach(c => { %>
      <option value="<%= c.label %>" <%= c.label === cycle ? 'selected' : '' %>><%= c.label %></option>
    <% }) %>
  </select>  
</form>

<% if (objectives.length === 0) { %>
  <div class="alert alert-warning">No objectives found for this organization.</div>
<% } else { %>
  <table class="table table-bordered">
    <thead class="table-light">
      <tr>
        <th>Title</th>
        <th>Team</th>
        <th>Cycle</th>
        <th>Status</th>
        <th>Progress</th>
        <th>Key Results</th>
        <th>Options</th>
      </tr>
    </thead>
    <tbody>
      <% objectives.forEach(obj => { %>
        <tr>
          <td><%= obj.title %></td>
          <td><%= obj.teamId?.name || 'N/A' %></td>
          <td><%= obj.cycle %></td>
          <td><%= obj.status %></td>
          <td><%= obj.progressValue %>%</td>
          <td>
            <a href="/<%= orgName %>/objectives/<%= obj._id %>/keyresults" class="btn btn-sm btn-outline-primary">ğŸ“ˆ KRs</a>
          </td>
          <td>
            <a href="/<%= orgName %>/objectives/<%= obj._id %>/edit" class="btn btn-sm btn-outline-secondary">âœï¸ Edit</a>
            <form action="/<%= orgName %>/objectives/<%= obj._id %>/delete" method="POST" style="display:inline">
              <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure?')">ğŸ—‘ Delete</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
<% } %>