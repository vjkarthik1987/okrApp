<% layout('layouts/dashboard') %>
<% title = item.title %>

<div class="mb-4">
  <h2 class="text-gradient">ğŸ“ <%= item.title %></h2>
  <p class="text-muted"><%= item.description || 'No description provided.' %></p>
</div>

<div class="row mb-4">
  <div class="col-md-6">
    <p><strong>ğŸ™‹ Assigned To:</strong> <%= item.assignedTo?.name || item.assignedTo?.email %></p>
    <p><strong>ğŸ§‘ Assigned By:</strong> <%= item.assignedBy?.name || item.assignedBy?.email %></p>
    <p>
      <strong>ğŸ“ Status:</strong>
      <% if (item.status === 'Completed') { %>
        <span class="badge bg-success">âœ… Completed</span>
      <% } else if (item.status === 'In Progress') { %>
        <span class="badge bg-warning text-dark">â³ In Progress</span>
      <% } else if (item.status === 'Blocked') { %>
        <span class="badge bg-danger">ğŸš« Blocked</span>
      <% } else if (item.status === 'Deferred') { %>
        <span class="badge bg-secondary">ğŸ• Deferred</span>
      <% } else if (item.status === 'On Hold') { %>
        <span class="badge bg-info text-dark">â¸ï¸ On Hold</span>
      <% } else { %>
        <span class="badge bg-primary">ğŸ†• Not Started</span>
      <% } %>
    </p>
    <p><strong>ğŸ“… Due Date:</strong> <%= item.dueDate ? new Date(item.dueDate).toDateString() : 'â€”' %></p>
  </div>
  <div class="col-md-6">
    <p><strong>ğŸ’¬ Meeting:</strong> <%= item.meeting || 'â€”' %></p>
    <p><strong>ğŸ“† OKR Cycle:</strong> <%= item.cycle?.label || 'â€”' %></p>
    <p><strong>ğŸ¯ Objective:</strong> <%= item.objectiveId?.title || 'â€”' %></p>
    <p><strong>ğŸ“ˆ Key Result:</strong> <%= item.keyResultId?.title || 'â€”' %></p>
  </div>
</div>

<hr class="my-4">

<h5 class="mb-3">ğŸ“š Update History</h5>
<% if (item.updates && item.updates.length > 0) { %>
  <ul class="list-group mb-4">
    <% item.updates.slice().reverse().forEach(u => { %>
      <li class="list-group-item d-flex justify-content-between">
        <span><%= u.updateText %></span>
        <small class="text-muted"><%= new Date(u.updateDate).toLocaleString() %></small>
      </li>
    <% }) %>
  </ul>
<% } else { %>
  <p class="text-muted">No updates yet.</p>
<% } %>

<h5 class="mb-3">ğŸ§‘â€ğŸ’¼ Manager Comments</h5>
<% if (item.comments && item.comments.length > 0) { %>
  <ul class="list-group mb-4">
    <% item.comments.slice().reverse().forEach(c => { %>
      <li class="list-group-item d-flex justify-content-between">
        <div>
          <strong><%= c.commenter?.name || 'Manager' %>:</strong> <%= c.commentText %>
          <% if (c.newStatus) { %>
            <span class="badge bg-info ms-2">Status: <%= c.newStatus %></span>
          <% } %>
        </div>
        <small class="text-muted"><%= new Date(c.commentDate).toLocaleString() %></small>
      </li>
    <% }) %>
  </ul>
<% } else { %>
  <p class="text-muted">No manager comments yet.</p>
<% } %>

<div class="text-end mt-4">
  <a href="/<%= orgName %>/actionItems/<%= item._id %>/edit" class="btn btn-primary">âœï¸ Edit</a>
  <a href="/<%= orgName %>/actionItems" class="btn btn-outline-secondary ms-2">â¬… Back</a>
</div>
